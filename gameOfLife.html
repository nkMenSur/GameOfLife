<html>
<head>
    <style type="text/css">
        td { width: 10px; line-height: 10px; }
        td:hover { cursor: pointer; }
        td.alive { background-color: #000; }
        .shape { display: inline-block; width: 80px; height: 60px; background-color: #808080; line-height: 60px; text-align: center; border: 3px groove black; }
        .shape:hover { cursor: pointer; }
        .label { display:inline-block; background-color:#cccccc; width:250px; text-align:center; }
    </style>
    <script src="jquery-1.8.2.js" type="text/javascript"></script>
    <script type="text/javascript"></script>
    <script type="text/ecmascript">
        function disableselect(e) {
            return false
        }
        function reEnable() {
            return true
        }
        document.onselectstart = new Function("return false")
        if (window.sidebar) {
            document.onmousedown = disableselect
            document.onclick = reEnable
        }
    </script>
    <script type="text/javascript">
        var dimension = 10;
        var chanceOfLifeCell = 0.5;
        var table;
        var cells;
        var percInp = new Array();
        var speeed;
        var counter = 0;
        var playing = false;

        var mouseDown = false;

        $(document).ready(function () {

            function machFeldSchwarz(feld) {
                if (feld.hasClass("dead")) {
                    feld.removeClass("dead");
                    feld.addClass("alive");
                }
                else {
                    feld.removeClass("alive");
                    feld.addClass("dead");
                }
            }

            $('*').live('mousedown', function () {
                mouseDown = true;
                machFeldSchwarz($(this));
            });
            $('*').live('mouseup', function () {
                mouseDown = false;
            });

            $('td').live('mouseenter', function () {
                if (mouseDown == true) {
                    machFeldSchwarz($(this));
                }
            });

            $('#restart').click(function () {
                if (Math.floor($('#percentageInput').val()) >= 0 && Math.floor($('#percentageInput').val()) <= 100 && Math.floor($('#dimInp').val()) > 0 && Math.floor($('#speeed').val()) > 0) {
                    chanceOfLifeCell = Math.floor($('#percentageInput').val()) / 100;
                    dimension = Math.floor($('#dimInp').val());
                    speeed = Math.floor($('#speeed').val());

                    $('td').remove();
                    tr = 0;
                    counter = 0;
                    initialiseGame();
                    cells = table.find('td');
                    placeRandomCells();
                }
                else {
                    alert('Du musst was sinvolles eingeben, du Pimmel!')
                }
            });

            $("#start").click(function () {
                if (Math.floor($('#percentageInput').val()) >= 0 && Math.floor($('#percentageInput').val()) <= 100 && Math.floor($('#speeed').val()) > 0) {
                    chanceOfLifeCell = Math.floor($('#percentageInput').val()) / 100;
                    dimension = Math.floor($('#dimInp').val())

                    speeed = Math.floor($('#speeed').val());
                    if (!playing) {
                        playing = setInterval('playGeneration()', speeed);
                        $("#start").text('Stop!');
                    }
                    else if (playing) {
                        clearInterval(playing);
                        playing = false;
                        $("#start").text('Go!')
                    };
                }
                else {
                    alert('Du musst was sinvolles eingeben, du Pimmel!')
                }
            });

            $("#kill").click(function () {
                $('td').removeClass('alive');
                {
                    $('td[class=""]').each(function () {
                        $(this).addClass('dead');

                    });
                }
                $('#counter').text('Counter!!');
                counter = 0;
            });
            table = jQuery('#main');
            initialiseGame();
            cells = table.find('td');
            placeRandomCells();
        });

        function playGeneration() {
            prepareNextGeneration();
            renderNextGeneration();
            counter++;
            $('#counter').text(counter);
        }

        function prepareNextGeneration() {
            for (var y = 0; y < dimension; y++) {
                for (var x = 0; x < dimension; x++) {
                    var cell = getCell(x, y);
                    var neighbours = getLiveNeighbourCount(x, y);
                    cell.attr('isalive', 'false');
                    if (isCellAlive(x, y)) {
                        if (neighbours === 2 || neighbours === 3) {
                            cell.attr('isalive', 'true');
                        }
                        else if (neighbours > 3) {
                            cell.attr('isalive', 'false');
                        }
                        else if (neighbours < 2) {
                            cell.attr('isalive', 'false');
                        }
                    }
                    else if (getCell(x, y).hasClass('dead') && neighbours === 3) {
                        cell.attr('isalive', 'true')
                    }
                }
            }
        }

        function renderNextGeneration() {
            cells.each(function () {
                var cell = $(this);
                cell.removeClass('alive');
                if (cell.attr('isalive') === 'true') {
                    cell.addClass('alive');
                }
                else if (cell.attr('isalive') === 'false') {
                    cell.addClass('dead');
                };
                cell.removeAttr('isalive');
            });
        };

        function getLiveNeighbourCount(x, y) {
            var count = 0;
            if (isCellAlive(x - 1, y - 1)) count++;
            if (isCellAlive(x, y - 1)) count++;
            if (isCellAlive(x + 1, y - 1)) count++;
            if (isCellAlive(x - 1, y)) count++;
            if (isCellAlive(x + 1, y)) count++;
            if (isCellAlive(x - 1, y + 1)) count++;
            if (isCellAlive(x, y + 1)) count++;
            if (isCellAlive(x + 1, y + 1)) count++;
            return count;
        }

        function isCellAlive(x, y) {
            return getCell(x, y).hasClass('alive');
        }

        function initialiseGame() {
            var tr = [];
            for (var y = 0; y < dimension; y++) {
                tr.push('<tr>');
                for (var x = 0; x < dimension; x++) {
                    tr.push('<td>&nbsp;</td>');
                }
                tr.push('</tr>');
            }
            tr = tr.join('');
            table.append($(tr));
        }

        function placeRandomCells() {
            for (var y = 0; y < dimension; y++) {
                for (var x = 0; x < dimension; x++) {
                    var cell = getCell(x, y);
                    
                    if (Math.random() > chanceOfLifeCell) {
                        cell.removeClass();
                        cell.addClass('dead');
                    }
                    else {
                        cell.addClass('alive');
                    }
                }
            }
        }

        function getCell(x, y) {
            if (x >= dimension) { x = 0 }
            if (y >= dimension) { y = 0 }
            if (x < 0) { x = dimension - 1; }
            if (y < 0) { y = dimension - 1; }
            return $(cells[y * dimension + x]);
        }
    </script>
    <title>Game of Life</title>
</head>
<body>
    <div id="start" class="shape">Go!</div>
    <div id="kill" class="shape">Kill!</div>
    <div id="restart" class="shape">Restart!</div>
    <div id="counter" class="shape">Counter!!</div>
    <div id="percentage">
        <div class="label">Prozentualer Anteil an lebenden Zellen:&nbsp&nbsp</div>
        <input id="percentageInput" type="text" value="50"/>
    </div>
    <div id="dimension">
        <div class="label">Seitenlänge:&nbsp&nbsp</div>
        <input id="dimInp" type="text" value="10"/>
    </div>
    <div>
        <div class="label">Refreshrate in Millisekunden:&nbsp&nbsp</div>
        <input id="speeed" type="text" value="100"/>
    </div>
    <table border="1" cellspacing="0" id="main"></table>
</body>
</html>
